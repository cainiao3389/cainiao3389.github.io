---
layout:     post
title:      "Sleep函数不执行"
subtitle:   "SQL注入中遇到了Sleep函数不执行的情况"
date:       2023-01-29 12:00:00
author:     "cainiao3389"
header-img: "img/post-bg-desk.jpg"
catalog: true
tags:
    - SQL注入
---

PS：在一次实战中，有一个站有SQL注入（差点错过），修改请求包中的参数值发现没有任何的变化，此时此刻，突然想到利用sleep延迟注入进行探测一波，一开始就是利用`' and sleep(3) and '1`进行探测，结果返回包一点响应没有。经过一波研究还是解决了这个问题，找到了SQL注入漏洞。下面听我细说。

## 理解Sleep函数

理解sleep函数：语句的执行具体会停留多长时间取决于满足条件的记录数。

在SQL注入的过程中，语句的执行具体会停留多长时间取决于满足条件的记录数。表中无数据则为null则无法执行。

---

## 理解子查询

**在SQL注入中，所查的表中无数据时，可以利用子查询语句进行突破。**

子查询也称“内部查询”或者“嵌套查询”，是指将一个 select 查询（子查询）的结果作为另一个 sql 语句（主查询）的数据来源或者判断条件。

理解子查询语法：

![图片](../img_blog/图片1.png)

---

## 某次实战中利用子查询突破限制

一个网站请求数据的API，里面的post的请求是`{"id":"1"}`  注意：返回包是200但是没有返回任何数据，是空的

一开始直接传入：`{"id":"1'"}` 查看返回包，没有任何回显。

在开始传入：`{"id":"1' or '1'='1"}` 这回我用or应该会有东西出来把，结果奶奶的还是啥都没有。

怀疑是闭合的问题，会不会是整数闭合，然后继续传入：`{"id":"1 or 1=1 "}` 我干还是啥都没有，然后我还测试了双引号闭合的，还是一样。

我想既然没有回显，那我就用sleep函数，继续传入：`{"id":"1' and sleep(3) and '1"}` 奶奶的，还是没有回显，也没有响应延迟，好，我放弃。

在拉屎的过程中，我突然想到如果表为空，用`and sleep(xx)` 肯定不得行啊。但是利用子查询进行sleep却可以，赶紧拉完屎继续搞。

终于我利用子查询语句成功执行了sleep函数，具体传入：**`{"id":"1' and (select * from (select sleep(5))a) and '1"}`** 成功执行了SQL语句，返回包的相应时间为5秒。

